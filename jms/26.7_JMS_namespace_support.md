##26.7 JMS命名空间的支持
Spring提供了一个XML命名空间，用于简化JMS配置。 要使用JMS命名空间元素，您需要引用JMS模式：

```//java
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xmlns:jms="http://www.springframework.org/schema/jms"
		xsi:schemaLocation="
			http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
			http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms.xsd">

	<!-- bean definitions here -->

</beans>
```

命名空间由三个顶级元素组成：<annotation-driven />，<listener-container />和<jca-listener-container />。 <annotation-driven可以使用[注解驱动的监听端点](http://docs.spring.io/spring/docs/5.0.0.M5/spring-framework-reference/html/jms.html#jms-annotated)。 <listener-container />和<jca-listener-container />定义共享监听容器的配置，并且包含了<listener />子元素。 以下是两个监听器的基本配置示例。

```//java
<jms:listener-container>

	<jms:listener destination="queue.orders" ref="orderService" method="placeOrder"/>

	<jms:listener destination="queue.confirmations" ref="confirmationLogger" method="log"/>

</jms:listener-container>
```

上面的示例相当于创建两个不同的监听容器bean定义和两个不同的MessageListenerAdapter bean定义，如[第26.4.4节“MessageListenerAdapter”](http://docs.spring.io/spring/docs/5.0.0.M5/spring-framework-reference/html/jms.html#jms-receiving-async-message-listener-adapter)中所示。 除了上面显示的属性之外，listener元素也包含几个可选属性。 下表描述了所有可用属性：

#### 表26.1 JMS \<listner\>的元素属性

属性|描述
---|---
id|托管监听容器的bean名称。如果未指定，将自动生成。
destination（必选）|监听器的目标名称，通过DestinationResolver策略解析获得。
ref（必选）|handler对象的bean名称。
method|调用handler方法的名称。 如果ref指向MessageListener或Spring SessionAwareMessageListener，则可以省略此属性。
response-destination|将响应消息发送到的默认的响应目标名称。 在不附带“JMSReplyTo”字段的请求消息的情况下将应用这一点。 该目标类型将由监听容器的“response-destination-type”属性确定。 注意：这仅适用于具有返回值的监听器方法，每个结果对象都将被转换为响应消息。
subscription|持久订阅的名称（如果有）。
selector|监听器可选的消息选择器。
concurrency|监听器启动的会话/消费者的并发数量。 可以是表示最大数量（例如“5”）的简单数字，也可以是表示下限以及上限（例如“3-5”）的范围。 请注意，指定的最小值只是一个提示，在运行时可能会被忽略。 默认值是容器提供的值。

<listener-container />元素也接受几个可选属性。 这允许自定义各种策略（例如，taskExecutor和destinationResolver）以及基本的JMS设置和资源引用。 使用这些属性，可以定义高度自定义的监听容器，同时仍然从命名空间的便利中受益。

这样的设置可以当做一个JmsListenerContainerFactory来自动公开，该JmsListenerContainerFactory通过factory-id属性指定了要公开的bean的id。

```//java
jms:listener-container connection-factory="myConnectionFactory"
		task-executor="myTaskExecutor"
		destination-resolver="myDestinationResolver"
		transaction-manager="myTransactionManager"
		concurrency="10">

	<jms:listener destination="queue.orders" ref="orderService" method="placeOrder"/>

	<jms:listener destination="queue.confirmations" ref="confirmationLogger" method="log"/>

</jms:listener-container>
```

下表描述了所有可用的属性。 请参阅AbstractMessageListenerContainer及其具体子类的类级别javadoc，以获取有关各个属性的更多详细信息。 javadoc还提供了有关事务选择和消息重新传递场景的讨论。

#### 表26.2 JMS \<listner-container\>的元素属性

属性|描述
---|---
container-type|监听容器的类型。 可用的选项有：default，simple，default102或simple102（默认值为“default”）。
container-class|自定义监听容器的实现类作为完全限定类名。 默认是Spring的标准DefaultMessageListenerContainer或SimpleMessageListenerContainer，取决于“container-type”属性。
factory-id|通过对JmsListenerContainerFactory指定id，暴露该元素的设置，以便它们可以与其他端点一起使用。
connection-factory|对JMS ConnectionFactory bean的引用（默认bean名称为“connectionFactory”）。
task-executor|对JMS监听器调用者的Spring TaskExecutor的引用。
destination-resolver|对解决JMS目标的DestinationResolver策略的引用。
message-converter|对JMS消息转换为监听器方法参数的MessageConverter策略的引用。 默认是一个SimpleMessageConverter。
error-handler|对处理任何未捕获异常的ErrorHandler策略的引用，异常可能发生在MessageListener的执行期间。
destination-type|监听器的JMS目标类型：queue，topic，durableTopic，sharedTopic或sharedDurableTopic。 这样可以间接启用容器的pubSubDomain，subscriptionDurable和subscriptionShared属性。 默认是队列（即禁用这3个属性）。
response-destination-type|响应的JMS目标类型：“queue”，“topic”。 默认值为“destination-type”属性的值。
client-id|监听容器的JMS客户ID。 使用持久订阅时需要指定。
cache|JMS资源的缓存级别：none, connection, session, consumer 或者 auto。 默认情况下（auto），缓存级别有效的是“consumer”。除非已经指定了外部事务管理器，在这种情况下，有效的默认值为none（假设Java EE风格的事务管理，其中给定的ConnectionFactory是XA-aware池）。
acknowledge|原生JMS确认模式：auto，client，dups-ok或transacted。 transacted值激活了本地交易的会话。 或者，指定下面描述的transaction-manager属性。 默认为auto。
transaction-manager|对外部PlatformTransactionManager的引用（通常是基于XA的事务协调器，例如Spring的JtaTransactionManager）。 如果未指定，将使用本地确认（请参阅“acknowledge”属性）。
concurrency|每个监听器启动的会话/消费者的并发数量。 可以是表示最大数量（例如“5”）的简单数字，也可以是表示下限以及上限（例如“3-5”）的范围。 请注意，指定的最小值只是一个提示，在运行时可能会被忽略。 默认值为1; 在topic监听器或者queue的次序很重要的情况下，将并发限制为1; 一般的queue可以考虑提高并发数。
prefetch|要加载到单个会话的消息的最大数量。 请注意，提高此数量可能会导致并发消费者的饥饿！
receive-timeout|用于接收调用的超时时间（以毫秒为单位）。 默认值为1000 ms（1秒）; -1表示没有超时限制。
back-off|指定用于计算恢复尝试间隔的BackOff实例。 如果BackOffExecution实现返回BackOffExecution＃STOP，监听容器将不再进一步尝试恢复。 当设置此属性时，将忽略recovery-interval值。 默认值为FixedBackOff，间隔为5000 ms，即5秒。
recovery-interval|指定恢复尝试之间的间隔（以毫秒为单位）。 是以指定间隔创建FixedBackOff的便捷方式。 有关更多恢复选项，请考虑指定BackOff实例。 默认值为5000 ms，即5秒。
phase|此容器应在其中开始和停止的生命周期阶段。 值越小，容器就越早启动，并且更晚停止。 默认值为Integer.MAX_VALUE，意味着容器将尽可能晚地启动并尽快停止。

使用“jms”的模式支持来配置基于JCA的监听容器是非常相似。

```//java
<jms:jca-listener-container resource-adapter="myResourceAdapter"
		destination-resolver="myDestinationResolver"
		transaction-manager="myTransactionManager"
		concurrency="10">

	<jms:listener destination="queue.orders" ref="myMessageListener"/>

</jms:jca-listener-container>
```

下表列出了JCA变体的可用配置选项：

#### 表26.3 JMS \<jca-listner-container\>的元素属性

属性|描述
---|---
factory-id||通过对JmsListenerContainerFactory指定id，暴露该元素的设置，以便它们可以与其他端点一起使用。
resource-adapter|对JCA ResourceAdapter bean的引用（默认bean名称是“resourceAdapter”）。
activation-spec-factory|对JmsActivationSpecFactory的引用。 默认情况是自动检测JMS供应商及其ActivationSpec类（请参阅DefaultJmsActivationSpecFactory）
destination-resolver|对解决JMS目标的DestinationResolver策略的引用。
message-converter|对JMS消息转换为监听器方法参数的MessageConverter策略的引用。 默认是一个SimpleMessageConverter。
error-handler|对处理任何未捕获异常的ErrorHandler策略的引用，异常可能发生在MessageListener的执行期间。
destination-type|监听器的JMS目标类型：queue，topic，durableTopic，sharedTopic或sharedDurableTopic。 这样可以间接启用容器的pubSubDomain，subscriptionDurable和subscriptionShared属性。 默认是队列（即禁用这3个属性）。
response-destination-type|响应的JMS目标类型：“queue”，“topic”。 默认值为“destination-type”属性的值。
client-id|监听容器的JMS客户ID。 使用持久订阅时需要指定。
acknowledge|原生JMS确认模式：auto，client，dups-ok或transacted。 transacted值激活了本地交易的会话。 或者，指定下面描述的transaction-manager属性。 默认为auto。
transaction-manager|对Spring JtaTransactionManager或javax.transaction.TransactionManager的引用，为每个传入消息启动XA事务。 如果未指定，将使用本地确认（请参阅“acknowledge”属性）。
concurrency|每个监听器启动的会话/消费者的并发数量。 可以是表示最大数量（例如“5”）的简单数字，也可以是表示下限以及上限（例如“3-5”）的范围。 请注意，指定的最小值只是一个提示，在使用JCA监听容器的运行时可能会被忽略。 默认值为1;
prefetch|要加载到单个会话的消息的最大数量。 请注意，提高此数量可能会导致并发消费者的饥饿！








